
# ===========================================
# PRODUCTION-SAFE SPRING BOOT CONFIGURATION FOR RAILWAY + RENDER
# ===========================================

spring.application.name=${APP_NAME:financial-ledger-backend}

# Server Configuration
server.port=${PORT:8080}

# ===========================================
# RAILWAY MYSQL DATABASE CONFIGURATION
# ===========================================
# CRITICAL: This URL is for Railway's persistent MySQL database
# Ensure you have enabled persistent storage in Railway dashboard
spring.datasource.url=${DATABASE_URL:jdbc:mysql://mysql.railway.internal:3306/railway?useSSL=true&requireSSL=true&serverTimezone=UTC&allowPublicKeyRetrieval=true&autoReconnect=true&failOverReadOnly=false}
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.datasource.username=${DB_USERNAME:root}
spring.datasource.password=${DB_PASSWORD:oRJZwEopJZhRPGAURAPBtKcMjovtpuzz}

# Production Connection Pool Settings
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.connection-timeout=60000
spring.datasource.hikari.leak-detection-threshold=60000

# ===========================================
# JPA/HIBERNATE CONFIGURATION (PRODUCTION-SAFE)
# ===========================================
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect

# ðŸš¨ CRITICAL SETTING: NEVER recreate tables in production
# This prevents data loss on redeployment
spring.jpa.hibernate.ddl-auto=none

# Production: Disable SQL logging for performance
spring.jpa.show-sql=false

# Hibernate optimizations for production
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

# ===========================================
# DATABASE INITIALIZATION (PRODUCTION-SAFE)
# ===========================================
# ðŸš¨ CRITICAL SETTING: NEVER run SQL init scripts in production
# This prevents data wiping on startup
spring.sql.init.mode=never

# ===========================================
# SECURITY & CORS CONFIGURATION
# ===========================================
# Update CORS_ALLOWED_ORIGINS with your actual Vercel domain
# Example: https://your-app-name.vercel.app
cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:3001}

# ===========================================
# JWT CONFIGURATION
# ===========================================
# ðŸš¨ CRITICAL: Generate a secure 256-bit secret for production
# Run: openssl rand -base64 32
jwt.secret=${JWT_SECRET:CHANGE_THIS_IN_PRODUCTION_TO_A_SECURE_256_BIT_KEY}
jwt.expiration=${JWT_EXPIRATION:86400000}

# ===========================================
# FILE UPLOAD CONFIGURATION
# ===========================================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.file-size-threshold=2KB
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB

# ===========================================
# LOGGING CONFIGURATION (PRODUCTION)
# ===========================================
logging.level.com.financial.ledger=INFO
logging.level.org.springframework.security=WARN
logging.level.org.springframework.web=WARN
logging.level.org.hibernate=WARN
# Enable SQL logging in debug mode only
logging.level.org.hibernate.SQL=OFF
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=OFF

# ===========================================
# HEALTH CHECKS & MONITORING
# ===========================================
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized
management.health.db.enabled=true

# ===========================================
# DISABLE IN-MEMORY DATABASES (PRODUCTION SAFETY)
# ===========================================
# ðŸš¨ CRITICAL: Ensure no fallback to H2 or in-memory databases
spring.h2.console.enabled=false
spring.datasource.initialization-mode=never

# ===========================================
# PRODUCTION CHECKLIST
# ===========================================
# âœ… Railway: Enable persistent storage (1GB+ recommended)
# âœ… Railway: Verify DATABASE_URL, DB_USERNAME, DB_PASSWORD
# âœ… Render: Set all environment variables correctly
# âœ… Vercel: Configure REACT_APP_API_BASE_URL
# âœ… JWT: Use 256-bit secret (not default value)
# âœ… CORS: Update with actual Vercel domain
# âœ… ddl-auto: MUST be 'none' (never 'update')
# âœ… sql.init.mode: MUST be 'never' (never 'always')
# âœ… H2: MUST be disabled
